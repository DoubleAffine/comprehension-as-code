---
phase: 01-comprehension-format
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/comprehension/__init__.py
  - src/comprehension/schema/__init__.py
  - src/comprehension/schema/confidence.py
  - src/comprehension/schema/observation.py
  - src/comprehension/schema/comprehension.py
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "Pydantic models exist that define Observation and Comprehension types"
    - "Comprehension model includes Bayesian structure (prior, observations, posterior)"
    - "Confidence levels are defined as natural language enum (HIGH/MEDIUM/LOW/UNKNOWN)"
    - "Models can be imported from comprehension.schema"
  artifacts:
    - path: "src/comprehension/schema/observation.py"
      provides: "Raw observation model"
      exports: ["Observation"]
    - path: "src/comprehension/schema/comprehension.py"
      provides: "Comprehension model with Bayesian structure"
      exports: ["Comprehension", "BeliefPrior", "BeliefPosterior"]
    - path: "src/comprehension/schema/confidence.py"
      provides: "Confidence level enum"
      exports: ["ConfidenceLevel"]
    - path: "pyproject.toml"
      provides: "Project configuration with Pydantic dependency"
      contains: "pydantic"
  key_links:
    - from: "src/comprehension/schema/comprehension.py"
      to: "src/comprehension/schema/confidence.py"
      via: "import"
      pattern: "from .confidence import ConfidenceLevel"
    - from: "src/comprehension/schema/comprehension.py"
      to: "src/comprehension/schema/observation.py"
      via: "references observation IDs"
      pattern: "observations.*List\\[str\\]"
---

<objective>
Define Pydantic schema models for Observation and Comprehension types.

Purpose: Establish the foundational data models that distinguish raw observations (events) from comprehension (structured understanding with Bayesian belief updates). These models will validate all comprehension documents in the system.

Output: Python module `comprehension.schema` with Pydantic models for Observation, Comprehension, and supporting types (ConfidenceLevel, BeliefPrior, BeliefPosterior).
</objective>

<execution_context>
@/Users/ianphilipp/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ianphilipp/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-comprehension-format/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Python project with Pydantic</name>
  <files>pyproject.toml, src/comprehension/__init__.py, src/comprehension/schema/__init__.py</files>
  <action>
Create pyproject.toml with:
- Project name: comprehension-as-code
- Python version: >=3.11
- Dependencies: pydantic>=2.0, pyyaml>=6.0, python-frontmatter>=1.0
- Build system: hatchling or setuptools

Create directory structure:
- src/comprehension/__init__.py (empty or version only)
- src/comprehension/schema/__init__.py (will re-export models)

Use modern Python packaging (pyproject.toml, not setup.py). Include optional dev dependencies: pytest, pytest-cov.
  </action>
  <verify>
- `ls src/comprehension/schema/__init__.py` exists
- `grep pydantic pyproject.toml` shows pydantic in dependencies
  </verify>
  <done>Python project structure exists with Pydantic as dependency</done>
</task>

<task type="auto">
  <name>Task 2: Create Confidence and Observation models</name>
  <files>src/comprehension/schema/confidence.py, src/comprehension/schema/observation.py</files>
  <action>
Create confidence.py with ConfidenceLevel enum:
```python
class ConfidenceLevel(str, Enum):
    HIGH = "high"      # Verified against behavior; multiple confirmations
    MEDIUM = "medium"  # Single confirmation; reasonable evidence
    LOW = "low"        # Tentative; needs validation
    UNKNOWN = "unknown"  # Explicitly uncertain
```

Create observation.py with Observation model:
```python
class Observation(BaseModel):
    id: str                                    # Unique identifier (e.g., "obs-001")
    timestamp: datetime                        # When observed
    source: str                                # Agent/system that made observation
    event: str                                 # What was observed (natural language)
    context: dict = Field(default_factory=dict) # Additional context
    trace_ref: Optional[str] = None            # Link to full trace if available
```

Use Pydantic v2 syntax. Include docstrings explaining each field's purpose.
  </action>
  <verify>
- `python -c "from comprehension.schema.confidence import ConfidenceLevel; print(ConfidenceLevel.HIGH.value)"` outputs "high"
- `python -c "from comprehension.schema.observation import Observation; print(Observation.model_fields.keys())"` shows expected fields
  </verify>
  <done>ConfidenceLevel enum and Observation model exist and are importable</done>
</task>

<task type="auto">
  <name>Task 3: Create Comprehension model with Bayesian structure</name>
  <files>src/comprehension/schema/comprehension.py, src/comprehension/schema/__init__.py</files>
  <action>
Create comprehension.py with:

1. BeliefPrior model:
```python
class BeliefPrior(BaseModel):
    statement: str              # Natural language belief
    confidence: ConfidenceLevel # How confident before observations
    source: str                 # "training" | "accumulated" | "documentation" | etc.
    reasoning: Optional[str] = None  # Why this was the prior
```

2. BeliefPosterior model:
```python
class BeliefPosterior(BaseModel):
    statement: str              # Natural language updated belief
    confidence: ConfidenceLevel # How confident after observations
    update_reasoning: str       # How observations changed belief
    observations_used: List[str] # References to observation IDs
```

3. Comprehension model (main):
```python
class Comprehension(BaseModel):
    id: str                     # Unique identifier
    topic: str                  # What this comprehension is about
    domain: str                 # Category/domain for retrieval
    prior: BeliefPrior          # Belief before observations
    observations: List[str]     # Observation IDs (not embedded)
    posterior: BeliefPosterior  # Updated belief
    created: datetime
    updated: datetime
    version: int = 1
    verified: bool = False      # Has behavioral verification passed?
    spec: str = "comprehension/v1"  # Schema version
```

Update schema/__init__.py to re-export all models:
```python
from .confidence import ConfidenceLevel
from .observation import Observation
from .comprehension import Comprehension, BeliefPrior, BeliefPosterior

__all__ = ["ConfidenceLevel", "Observation", "Comprehension", "BeliefPrior", "BeliefPosterior"]
```
  </action>
  <verify>
- `python -c "from comprehension.schema import Comprehension, BeliefPrior, BeliefPosterior, ConfidenceLevel, Observation; print('All imports OK')"`
- `python -c "from comprehension.schema import Comprehension; print(Comprehension.model_json_schema())"` produces valid JSON schema
  </verify>
  <done>Comprehension model with Bayesian structure (prior/posterior) exists and can export JSON schema</done>
</task>

</tasks>

<verification>
1. All schema models importable: `python -c "from comprehension.schema import *"`
2. JSON Schema generation works: `python -c "from comprehension.schema import Comprehension; import json; print(json.dumps(Comprehension.model_json_schema(), indent=2))"`
3. Bayesian structure present: Comprehension model has `prior` (BeliefPrior) and `posterior` (BeliefPosterior) fields
4. Confidence levels defined: ConfidenceLevel enum has HIGH, MEDIUM, LOW, UNKNOWN values
</verification>

<success_criteria>
- [ ] pyproject.toml exists with pydantic>=2.0 dependency
- [ ] All models importable from `comprehension.schema`
- [ ] Comprehension model includes prior (BeliefPrior) and posterior (BeliefPosterior)
- [ ] ConfidenceLevel enum has 4 natural language levels
- [ ] Observation model is separate from Comprehension model
- [ ] JSON Schema can be generated from Pydantic models
</success_criteria>

<output>
After completion, create `.planning/phases/01-comprehension-format/01-01-SUMMARY.md`
</output>
